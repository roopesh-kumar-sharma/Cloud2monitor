<!-- templates/dashboard.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Monitor Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.30.0/dist/apexcharts.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            padding: 20px;
        }
        h1 {
            color: #1e67c7;
            margin-bottom: 30px;
            text-decoration: dashed;
        }
    </style>

</head>
<body>
    <h1 align="center">Cloud Monitor Dashboard</h1>

    <form id="monitor-form" target="_blank">
        <div class="form-group">
            <label for="cloud_provider">Cloud Provider:</label>
            <select id="cloud_provider" name="cloud_provider" class="form-control" required>
                <option value="aws">AWS</option>
                <option value="azure">Azure</option>
                <option value="gcp">GCP</option>
            </select>
        </div>

        <div class="form-group" id="aws-fields">
            <label for="aws_access_key">AWS Access ID:</label>
            <input type="text" id="aws_access_key" name="aws_access_key" class="form-control" required>

            <label for="aws_secret_key">AWS Secret Key:</label>
            <input type="text" id="aws_secret_key" name="aws_secret_key" class="form-control" required>

            <label for="aws_region">AWS Region:</label>
            <input type="text" id="aws_region" name="aws_region" class="form-control" placeholder="Enter AWS Region" required>

            <label for="instance_id">Instance ID:</label>
            <input type="text" id="instance_id" name="instance_id" class="form-control" required>
        </div>

        <div class="form-group" id="azure-fields" style="display: none;">
            <label for="azure_vm_id">Azure VM ID:</label>
            <input type="text" id="azure_vm_id" name="azure_vm_id" class="form-control">

            <label for="azure_region">Azure Region:</label>
            <input type="text" id="azure_region" name="azure_region" class="form-control" placeholder="Enter Azure Region">
        </div>

        <div class="form-group" id="gcp-fields" style="display: none;">
            <label for="gcp_project_id">GCP Project ID:</label>
            <input type="text" id="gcp_project_id" name="gcp_project_id" class="form-control">

            <label for="gcp_instance_id">GCP Instance ID:</label>
            <input type="text" id="gcp_instance_id" name="gcp_instance_id" class="form-control">
        </div>

        <button type="button" onclick="monitor_instance()" class="btn btn-primary">Monitor</button>
    </form>

    <div id="monitor-results" class="mt-4">
        <!-- Real-time monitoring results will be displayed here -->
    </div>

        <div id="chart"></div>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.30.0/dist/apexcharts.min.js"></script>
    <script>
        let intervalId;

        function monitor_instance() {
            const form = document.getElementById('monitor-form');
            const cloudProvider = form.elements['cloud_provider'].value;
            const formData = new FormData();

            // Add common fields to formData
            formData.append('cloud_provider', cloudProvider);
            formData.append('instance_id', form.elements['instance_id'].value);

            // Add cloud provider-specific fields to formData
            if (cloudProvider === 'aws') {
                formData.append('aws_access_key', form.elements['aws_access_key'].value);
                formData.append('aws_secret_key', form.elements['aws_secret_key'].value);
                formData.append('aws_region', form.elements['aws_region'].value);
            } else if (cloudProvider === 'azure') {
                formData.append('azure_vm_id', form.elements['azure_vm_id'].value);
                formData.append('azure_region', form.elements['azure_region'].value);
            } else if (cloudProvider === 'gcp') {
                formData.append('gcp_project_id', form.elements['gcp_project_id'].value);
                formData.append('gcp_instance_id', form.elements['gcp_instance_id'].value);
            }

            const updateIntervalSeconds = 5;
            
            if (intervalId) {
                clearInterval(intervalId);
            }

            intervalId = setInterval(() => {
                fetch('/monitor', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    const resultsDiv = document.getElementById('monitor-results');
                    resultsDiv.innerHTML = `
                        <p>Instance ID: ${data.instance_id}</p>
                        <p>Uptime: ${data.uptime}</p>
                        <p>Public IP Address: ${data.public_ip_address}</p>
                        <p>CPU Utilization: ${data.cpu_utilization}</p>
                        <p>Memory Utilization: ${data.memory_utilization}</p>
                    `;

                    // Display CPU metric in a chart
                    displayCpuChart(data.cpu_utilization);

                })
                .catch(error => {
                    console.error('Error:', error);
                });
                
            }, updateIntervalSeconds * 1000);
        }

        function displayCpuChart(cpuUtilization) {
        const options = {
            chart: {
                type: 'line', // Change type to line
                height: '300', // Set the height of the chart
                width: '500',  // Set the width of the chart
            },
            series: [{
                name: 'CPU Utilization',
                data: [cpuUtilization.replace('%', '')], // Convert CPU utilization to numeric value
            }],
            xaxis: {
                categories: ['Current'], // Set x-axis categories, e.g., "Current"
            },
            yaxis: {
                title: {
                    text: 'CPU Utilization (%)' // Set y-axis title
                }
            },
        };

        const chart = new ApexCharts(document.getElementById('chart'), options);
        chart.render();
        }

        // Show/hide specific fields based on selection
        document.getElementById('cloud_provider').addEventListener('change', function() {
            const awsFields = document.getElementById('aws-fields');
            const azureFields = document.getElementById('azure-fields');
            const gcpFields = document.getElementById('gcp-fields');

            if (this.value === 'aws') {
                awsFields.style.display = 'block';
                azureFields.style.display = 'none';
                gcpFields.style.display = 'none';
            } else if (this.value === 'azure') {
                awsFields.style.display = 'none';
                azureFields.style.display = 'block';
                gcpFields.style.display = 'none';
            } else if (this.value === 'gcp') {
                awsFields.style.display = 'none';
                azureFields.style.display = 'none';
                gcpFields.style.display = 'block';
            } else {
                awsFields.style.display = 'none';
                azureFields.style.display = 'none';
                gcpFields.style.display = 'none';
            }
        });
    </script>
</body>
</html>
